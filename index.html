<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For Ria ‚Äî A Private Luxury Drawing</title>
  <meta name="description" content="A private, premium drawing playground for Ria ‚Äî silky brushes, gold ink, memories gallery, and elegant UI. Single-file, works on GitHub Pages." />
  <style>
    /* ----------------------
       Luxury theme variables
       ---------------------- */
    :root{
      --bg:#060406; /* deep black */
      --card: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.5);
      --gold: #d4af37;
      --rose: #f3d7d9;
      --glass: rgba(255,255,255,0.06);
      --glass-strong: rgba(255,255,255,0.08);
      --accent: linear-gradient(90deg, rgba(212,175,55,0.95), rgba(243,215,217,0.9));
      --soft-shadow: 0 6px 24px rgba(0,0,0,0.6);
      --radius: 14px;
      --font-sans: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    /* Reset */
    *{box-sizing:border-box}
    html,body,#app{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 20%, rgba(212,175,55,0.02), transparent),
                  radial-gradient(900px 400px at 90% 80%, rgba(243,215,217,0.015), transparent),
                  var(--bg);
      font-family:var(--font-sans);
      color: #eee;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }

    /* App shell */
    .container{
      display:grid;
      grid-template-columns: 360px 1fr 340px;
      gap:22px;
      padding:28px;
      height:100%;
      align-items:stretch;
    }

    /* Left panel (controls) */
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--soft-shadow);
      backdrop-filter: blur(8px) saturate(120%);
      border:1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:14px;
      min-height:0;
    }

    h1{font-size:18px;margin:0 0 2px 0;letter-spacing:0.4px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* Toolbar buttons */
    .tools{display:flex;flex-wrap:wrap;gap:10px}
    .btn{
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      padding:10px 12px;border-radius:12px;cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;font-size:13px;color:#eee;
      transition:all .18s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    .btn.primary{background:linear-gradient(90deg, rgba(212,175,55,0.12), rgba(243,215,217,0.03));border:1px solid rgba(212,175,55,0.22)}

    /* Canvas area (center) */
    .stage{
      position:relative;
      border-radius:var(--radius);
      overflow:hidden;
      padding:18px 18px 18px 18px;
      display:flex;flex-direction:column;gap:12px;
    }
    .canvas-wrap{
      flex:1;position:relative;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.025);
    }

    canvas{display:block;max-width:100%;height:100%;width:100%;touch-action:none}

    /* Right panel (gallery + layers) */
    .gallery{display:flex;flex-direction:column;gap:12px}
    .thumbs{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .thumb{height:120px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);display:flex;align-items:center;justify-content:center}

    /* Controls rows */
    .row{display:flex;gap:10px;align-items:center}
    .label{font-size:12px;color:var(--muted);min-width:82px}
    input[type=range]{-webkit-appearance:none;height:6px;background:linear-gradient(90deg, rgba(212,175,55,0.2), rgba(243,215,217,0.06));border-radius:999px;outline:none}

    /* Color swatches */
    .swatches{display:flex;gap:8px;flex-wrap:wrap}
    .sw{width:34px;height:34px;border-radius:8px;border:1px solid rgba(0,0,0,0.5);cursor:pointer;box-shadow:inset 0 -6px 24px rgba(0,0,0,0.3)}

    /* Floating header */
    .hud{position:absolute;left:50%;transform:translateX(-50%);top:18px;background:rgba(0,0,0,0.25);padding:8px 18px;border-radius:24px;border:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(6px)}

    /* Footer controls */
    .meta{display:flex;gap:10px;align-items:center;justify-content:space-between}

    /* Welcome / modal */
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(6,4,6,0.6), rgba(6,4,6,0.6));backdrop-filter: blur(6px);z-index:80}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:28px;border-radius:20px;border:1px solid rgba(255,255,255,0.04);max-width:720px;text-align:center}
    .card h2{font-size:22px;margin-bottom:6px}
    .small{font-size:13px;color:var(--muted)}

    /* heart bloom */
    .bloom{position:absolute;pointer-events:none;mix-blend-mode:screen;filter:drop-shadow(0 12px 40px rgba(212,175,55,0.25));}

    /* responsive */
    @media (max-width:1100px){
      .container{grid-template-columns:1fr;grid-template-rows:auto 1fr auto;padding:14px;gap:12px}
      .panel{order:3}
      .stage{order:2}
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">

      <!-- LEFT PANEL: TOOLS -->
      <aside class="panel" aria-label="tools panel">
        <div>
          <h1>For Ria ‚Äî Private Atelier</h1>
          <p class="lead">Silk brushes, gold ink & private gallery. Designed by Priyanshu.</p>
        </div>

        <div class="row">
          <div class="label">Brush</div>
          <div class="tools">
            <button class="btn primary" data-tool="gold">Gold Ink</button>
            <button class="btn" data-tool="silk">Silk</button>
            <button class="btn" data-tool="matte">Matte</button>
            <button class="btn" data-tool="eraser">Eraser</button>
          </div>
        </div>

        <div class="row">
          <div class="label">Size</div>
          <input id="size" type="range" min="1" max="120" value="18">
        </div>

        <div class="row">
          <div class="label">Opacity</div>
          <input id="opacity" type="range" min="0.05" max="1" step="0.01" value="0.98">
        </div>

        <div class="row">
          <div class="label">Colors</div>
          <div class="swatches" id="swatches">
            <!-- swatches injected by JS -->
          </div>
        </div>

        <div class="row">
          <div class="label">Actions</div>
          <div class="tools">
            <button class="btn" id="undo">Undo</button>
            <button class="btn" id="redo">Redo</button>
            <button class="btn" id="clear">Clear</button>
            <button class="btn" id="save">Save</button>
          </div>
        </div>

        <div style="margin-top:auto">
          <div class="small">Tip: double-tap canvas to undo last stroke. Use two fingers to pan on touch devices.</div>
        </div>
      </aside>

      <!-- CENTER STAGE: CANVAS -->
      <main class="stage">
        <div class="hud">Private ¬∑ For Ria</div>
        <div class="canvas-wrap" id="canvasWrap">
          <canvas id="c"></canvas>
          <div id="bloom" class="bloom"></div>
        </div>

        <div class="meta">
          <div class="small">Brush preview: <span id="previewText">Gold Ink ‚Ä¢ 18</span></div>
          <div>
            <button class="btn primary" id="exportPng">Download PNG</button>
            <button class="btn" id="toGallery">Save to Gallery</button>
          </div>
        </div>
      </main>

      <!-- RIGHT PANEL: GALLERY + LAYERS -->
      <aside class="panel gallery" aria-label="gallery and layers">
        <div>
          <h1 style="font-size:16px">Memory Gallery</h1>
          <p class="lead">Your saved artworks are stored locally in this browser.</p>
        </div>

        <div class="thumbs" id="thumbs"></div>

        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div class="small">Layers</div>
          <div class="small">3 layers ‚Ä¢ <span id="activeLayer">Layer 1</span></div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="addLayer">Add Layer</button>
          <button class="btn" id="mergeLayer">Merge Down</button>
          <button class="btn" id="clearGallery">Clear Gallery</button>
        </div>

      </aside>

    </div>
  </div>

  <!-- Welcome Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="card">
      <h2>For Ria ‚Äî Private Atelier</h2>
      <p class="small">Hello Ria üíû ‚Äî This little atelier is crafted just for you. A luxurious canvas with silky brushes and golden trails. Touch-friendly and private.</p>
      <div style="height:16px"></div>
      <input id="pass" type="password" placeholder="Enter password to continue" style="padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;width:60%" />
      <div style="height:12px"></div>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn primary" id="unlock">Unlock</button>
        <button class="btn" id="skip">Try Demo</button>
      </div>
      <p class="small" style="margin-top:12px">Hint: password is a little secret between you two ‚ù§Ô∏è</p>
    </div>
  </div>

  <audio id="bgm" loop src="" preload="auto"></audio>

  <script>
    /* -------------------------
       Utility + state
       ------------------------- */
    const state = {
      tool:'gold',
      size:18,
      opacity:0.98,
      color:'#d4af37',
      history:[],
      future:[],
      layers:[],
      activeLayer:0,
    };

    // canvas & ctx setup
    const c = document.getElementById('c');
    const canvasWrap = document.getElementById('canvasWrap');
    const ctx = c.getContext('2d', {alpha:true});

    function resizeCanvas(){
      const rect = canvasWrap.getBoundingClientRect();
      const ratio = window.devicePixelRatio || 1;
      c.width = Math.floor(rect.width * ratio);
      c.height = Math.floor(rect.height * ratio);
      c.style.width = rect.width + 'px';
      c.style.height = rect.height + 'px';
      ctx.setTransform(ratio,0,0,ratio,0,0);
      redrawAll();
    }

    window.addEventListener('resize', resizeCanvas);

    // layer representation: each layer is an offscreen canvas
    function createLayer(w,h){
      const off = document.createElement('canvas');
      off.width = w; off.height = h; off.style.display='none';
      off.getContext('2d');
      return off;
    }

    function ensureLayers(){
      if(state.layers.length===0){
        const base = createLayer(c.width||1024, c.height||600);
        state.layers.push(base);
      }
    }

    function redrawAll(){
      ctx.clearRect(0,0,c.width,c.height);
      // draw background subtle texture
      ctx.fillStyle = 'rgba(2,2,2,0.02)';
      ctx.fillRect(0,0,c.width,c.height);
      ensureLayers();
      for(const L of state.layers){
        const lctx = L.getContext('2d');
        ctx.drawImage(L,0,0);
      }
    }

    /* -------------------------
       Brush engine
       ------------------------- */
    let drawing=false, last=null;
    let points = [];

    function getPointerPos(e){
      const rect = c.getBoundingClientRect();
      if(e.touches && e.touches[0]){
        return {x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top};
      } else {
        return {x: e.clientX - rect.left, y: e.clientY - rect.top};
      }
    }

    function beginStroke(pt){
      drawing=true; points=[pt]; last=pt;
      // snapshot for undo
      pushHistory();
    }

    function endStroke(){
      drawing=false; points=[]; last=null;
    }

    // push history (limit to 30)
    function pushHistory(){
      try{
        const snap = c.toDataURL();
        state.history.push(snap);
        if(state.history.length>30) state.history.shift();
        state.future = [];
      }catch(e){console.warn('history fail',e)}
    }

    function undo(){
      if(state.history.length===0) return;
      const last = state.history.pop();
      state.future.push(c.toDataURL());
      const img = new Image();
      img.onload = ()=>{ ctx.clearRect(0,0,c.width,c.height); ctx.drawImage(img,0,0); }
      img.src = last;
    }
    function redo(){
      if(state.future.length===0) return;
      const f = state.future.pop();
      state.history.push(c.toDataURL());
      const img = new Image(); img.onload=()=>{ ctx.clearRect(0,0,c.width,c.height); ctx.drawImage(img,0,0); };
      img.src = f;
    }

    function drawLine(pt){
      if(!last) { last=pt; return; }
      const dx = pt.x - last.x; const dy = pt.y - last.y;
      const dist = Math.sqrt(dx*dx+dy*dy);
      const speed = Math.min(80, Math.max(0, dist));
      const baseSize = state.size;
      // emulate pressure: faster => thinner
      const sw = Math.max(1, baseSize * (1 - Math.min(0.9, speed/120)));

      const lctx = state.layers[state.activeLayer].getContext('2d');
      lctx.lineJoin = lctx.lineCap = 'round';

      if(state.tool === 'eraser'){
        lctx.globalCompositeOperation = 'destination-out';
        lctx.strokeStyle = 'rgba(0,0,0,1)';
        lctx.lineWidth = sw;
        lctx.beginPath(); lctx.moveTo(last.x, last.y); lctx.lineTo(pt.x, pt.y); lctx.stroke();
        lctx.globalCompositeOperation = 'source-over';
      } else if(state.tool === 'gold'){
        // gold ink: base stroke + glow
        lctx.globalCompositeOperation = 'source-over';
        lctx.lineWidth = sw;
        lctx.globalAlpha = state.opacity;
        // base faint trail
        lctx.strokeStyle = '#FFFFFF';
        lctx.beginPath(); lctx.moveTo(last.x, last.y); lctx.lineTo(pt.x, pt.y); lctx.stroke();
        // gold layer
        lctx.strokeStyle = state.color;
        lctx.lineWidth = Math.max(1, sw*0.6);
        lctx.beginPath(); lctx.moveTo(last.x, last.y); lctx.lineTo(pt.x, pt.y); lctx.stroke();
        // slight inner brighter line
        lctx.strokeStyle = 'rgba(255,255,255,0.08)';
        lctx.lineWidth = Math.max(1, sw*0.18);
        lctx.beginPath(); lctx.moveTo(last.x, last.y); lctx.lineTo(pt.x, pt.y); lctx.stroke();
        lctx.globalAlpha = 1;
      } else {
        lctx.globalCompositeOperation = 'source-over';
        lctx.strokeStyle = state.color;
        lctx.lineWidth = sw;
        lctx.globalAlpha = state.opacity;
        lctx.beginPath(); lctx.moveTo(last.x, last.y); lctx.lineTo(pt.x, pt.y); lctx.stroke();
        lctx.globalAlpha = 1;
      }

      last = pt;
      redrawAll();
    }

    // smoothing via interpolation
    function smoothAndDraw(pt){
      points.push(pt);
      if(points.length<3){ drawLine(pt); return; }
      const prev = points[points.length-2];
      const mid = {x:(prev.x+pt.x)/2, y:(prev.y+pt.y)/2};
      drawLine(mid);
    }

    /* -------------------------
       Events
       ------------------------- */
    c.addEventListener('pointerdown', (ev)=>{
      ev.preventDefault();
      c.setPointerCapture(ev.pointerId);
      beginStroke(getPointerPos(ev));
    });
    c.addEventListener('pointermove', (ev)=>{
      if(!drawing) return; ev.preventDefault(); smoothAndDraw(getPointerPos(ev));
    });
    c.addEventListener('pointerup', (ev)=>{ endStroke(); });
    c.addEventListener('pointercancel', (ev)=>{ endStroke(); });

    // double-click to undo
    c.addEventListener('dblclick', ()=>undo());

    // touch gestures: two-finger pan
    let touchCache = {active:false, lastMid:null};
    c.addEventListener('touchstart', (e)=>{
      if(e.touches.length===2){
        touchCache.active=true; touchCache.lastMid = midPoint(e.touches[0], e.touches[1]);
      }
    }, {passive:false});
    c.addEventListener('touchmove', (e)=>{
      if(touchCache.active && e.touches.length===2){
        const m = midPoint(e.touches[0], e.touches[1]);
        const dx = m.x - touchCache.lastMid.x; const dy = m.y - touchCache.lastMid.y;
        // pan layers by translating each layer canvas visually (simple approach: copy to offscreen then draw)
        for(const L of state.layers){
          const lctx = L.getContext('2d');
          const tmp = document.createElement('canvas'); tmp.width=L.width; tmp.height=L.height;
          tmp.getContext('2d').drawImage(L,0,0);
          lctx.clearRect(0,0,L.width,L.height);
          lctx.drawImage(tmp, dx, dy);
        }
        touchCache.lastMid = m;
        redrawAll();
      }
    }, {passive:false});
    c.addEventListener('touchend', ()=>{ touchCache.active=false; });
    function midPoint(a,b){ return {x:(a.clientX+b.clientX)/2 - c.getBoundingClientRect().left, y:(a.clientY+b.clientY)/2 - c.getBoundingClientRect().top}; }

    /* -------------------------
       UI bindings
       ------------------------- */
    document.querySelectorAll('[data-tool]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        state.tool = btn.dataset.tool; updateUI();
      });
    });
    document.getElementById('size').addEventListener('input', (e)=>{ state.size = parseInt(e.target.value); updatePreview(); });
    document.getElementById('opacity').addEventListener('input', (e)=>{ state.opacity = parseFloat(e.target.value); updatePreview(); });

    document.getElementById('undo').addEventListener('click', undo);
    document.getElementById('redo').addEventListener('click', redo);
    document.getElementById('clear').addEventListener('click', ()=>{ if(confirm('Clear the canvas?')){ state.layers.forEach(L=>L.getContext('2d').clearRect(0,0,L.width,L.height)); redrawAll(); pushHistory(); }});

    document.getElementById('save').addEventListener('click', ()=>{ const data = c.toDataURL('image/png'); downloadDataURL(data, 'ria_art.png'); });
    document.getElementById('exportPng').addEventListener('click', ()=>{ const data = c.toDataURL('image/png'); downloadDataURL(data, 'ria_masterpiece.png'); });

    document.getElementById('toGallery').addEventListener('click', ()=>{
      const data = c.toDataURL('image/png');
      const gallery = JSON.parse(localStorage.getItem('ria_gallery')||'[]');
      gallery.unshift({ts:Date.now(), data});
      if(gallery.length>20) gallery.pop();
      localStorage.setItem('ria_gallery', JSON.stringify(gallery));
      renderGallery();
      tastefulBloom();
    });

    document.getElementById('addLayer').addEventListener('click', ()=>{
      const L = createLayer(c.width, c.height); state.layers.push(L); state.activeLayer = state.layers.length-1; redrawAll(); updateLayerText(); pushHistory();
    });
    document.getElementById('mergeLayer').addEventListener('click', ()=>{
      if(state.layers.length<2) return alert('Need at least 2 layers');
      const top = state.layers.pop();
      const base = state.layers[state.layers.length-1];
      const bctx = base.getContext('2d'); bctx.drawImage(top,0,0);
      state.activeLayer = state.layers.length-1; redrawAll(); updateLayerText(); pushHistory();
    });

    document.getElementById('clearGallery').addEventListener('click', ()=>{ if(confirm('Clear gallery?')){ localStorage.removeItem('ria_gallery'); renderGallery(); }});

    function downloadDataURL(dataURL, filename){
      const a = document.createElement('a'); a.href = dataURL; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    }

    function updateUI(){
      document.querySelectorAll('[data-tool]').forEach(b=>b.classList.toggle('primary', b.dataset.tool===state.tool));
      updatePreview();
    }
    function updatePreview(){
      document.getElementById('previewText').textContent = (state.tool==='eraser'? 'Eraser' : (state.tool.charAt(0).toUpperCase()+state.tool.slice(1))) + ' ‚Ä¢ ' + state.size;
    }

    // swatches
    const palette = ['#d4af37','#f3d7d9','#fff3e6','#ffd6a5','#c9a0ff','#ffb3c6','#ffffff','#000000'];
    const swatchesEl = document.getElementById('swatches');
    palette.forEach(col=>{
      const el = document.createElement('div'); el.className='sw'; el.style.background = col; el.title = col;
      el.addEventListener('click', ()=>{ state.color = col; updatePreview(); });
      swatchesEl.appendChild(el);
    });

    /* -------------------------
       Gallery
       ------------------------- */
    function renderGallery(){
      const thumbs = document.getElementById('thumbs'); thumbs.innerHTML='';
      const gallery = JSON.parse(localStorage.getItem('ria_gallery')||'[]');
      if(gallery.length===0){ thumbs.innerHTML = '<div class="small" style="color:var(--muted)">No saved pieces yet. Save to gallery to keep a memory.</div>'; return; }
      gallery.forEach((item, idx)=>{
        const d = document.createElement('div'); d.className='thumb';
        const img = new Image(); img.src = item.data; img.style.maxWidth='100%'; img.style.maxHeight='100%'; img.style.objectFit='cover';
        d.appendChild(img);
        d.addEventListener('click', ()=>{
          if(confirm('Load this artwork to canvas?')){
            const image = new Image(); image.onload = ()=>{ ctx.clearRect(0,0,c.width,c.height); ctx.drawImage(image,0,0); pushHistory(); }; image.src = item.data;
          }
        });
        thumbs.appendChild(d);
      });
    }

    /* -------------------------
       Bloom effect when saved
       ------------------------- */
    function tastefulBloom(){
      const b = document.getElementById('bloom');
      b.innerHTML='';
      const heart = document.createElement('div');
      heart.style.width='220px'; heart.style.height='220px';
      heart.innerHTML = `
        <svg viewBox="0 0 32 29.6" width="220" height="220" xmlns="http://www.w3.org/2000/svg">
          <path d="M23.6,0c-2.8,0-4.9,1.8-5.6,3.4C17.3,1.8,15.2,0,12.4,0C7.4,0,3.6,3.9,3.6,8.8c0,5.6,9.6,11.6,13.6,18C19.8,20.4,29.6,14.4,29.6,8.8C29.6,3.9,25.8,0,20.8,0H23.6z" fill="url(#g)" />
          <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ffd78a"/><stop offset="1" stop-color="#ffdbe1"/></linearGradient></defs>
        </svg>`;
      b.appendChild(heart);
      b.style.position='absolute'; b.style.left='50%'; b.style.top='50%'; b.style.transform='translate(-50%,-50%) scale(0)'; b.style.transition='transform .8s cubic-bezier(.2,.9,.3,1), opacity .8s'; b.style.opacity='1';
      requestAnimationFrame(()=>{ b.style.transform='translate(-50%,-50%) scale(1)'; });
      setTimeout(()=>{ b.style.opacity='0'; b.style.transform='translate(-50%,-50%) scale(1.4)'; },1600);
    }

    /* -------------------------
       Init
       ------------------------- */
    function init(){
      resizeCanvas();
      // prepare 2 layers by default
      state.layers = [createLayer(c.width, c.height), createLayer(c.width, c.height)];
      state.activeLayer = 0;
      updateUI(); renderGallery(); updateLayerText(); pushHistory();
    }

    function updateLayerText(){ document.getElementById('activeLayer').textContent = 'Layer ' + (state.activeLayer+1); }

    // modal unlock
    const modal = document.getElementById('modal');
    document.getElementById('unlock').addEventListener('click', ()=>{
      const pass = document.getElementById('pass').value.trim();
      // simple playful password check ‚Äî adjust as you like
      if(pass.toLowerCase()===('ourstory') || pass.toLowerCase().includes('ria')){
        modal.style.display='none'; startBGM();
      } else {
        alert('Wrong password ‚Äî try something you both share.');
      }
    });
    document.getElementById('skip').addEventListener('click', ()=>{ modal.style.display='none'; startBGM(); });

    // background music (optional) - embedded base64 silent placeholder to avoid external requests
    function startBGM(){
      try{ const bgm = document.getElementById('bgm'); /* leave empty for privacy; user can set own audio by dragging a file into the player in future iterations */ }catch(e){ }
    }

    // double-tap undo shortcut for touch
    let lastTap = 0; c.addEventListener('touchend', ()=>{ const now = Date.now(); if(now-lastTap<300) undo(); lastTap = now; });

    // initial run
    init();

    // save before unload
    window.addEventListener('beforeunload', ()=>{ try{ localStorage.setItem('ria_autosave', c.toDataURL()); }catch(e){} });

    // load autosave if any
    (function tryRestore(){ const d = localStorage.getItem('ria_autosave'); if(d){ const img = new Image(); img.onload=()=>{ ctx.clearRect(0,0,c.width,c.height); ctx.drawImage(img,0,0); }; img.src=d; } })();
  </script>

</body>
</html>
