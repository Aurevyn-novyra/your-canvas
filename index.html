<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My RealDiary ‚Äî Priyanshu & Ria</title>
  <meta name="description" content="Realistic diary web app ‚Äî page turn, write, save PNG, and library (single file)." />
  <style>
    /* ---------- Reset ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body,#app{height:100%}
    body{
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(ellipse at 10% 10%, rgba(255,255,255,0.02) 0%, transparent 20%),
                  linear-gradient(180deg,#05060a 0%, #0b0d12 60%);
      color:#e9eef8; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      overflow:hidden;
    }

    /* ---------- Background stars / particles ---------- */
    .bg-stars{position:fixed;inset:0;pointer-events:none;z-index:0;}
    .bg-stars canvas{width:100%;height:100%;display:block}

    /* ---------- Centered glass Enter ---------- */
    .enter-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:10}
    .glass{
      width:min(720px,90%);max-width:980px;padding:48px;border-radius:16px;backdrop-filter: blur(8px) saturate(120%);
      background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.06);box-shadow:0 8px 40px rgba(3,6,15,0.7);display:flex;gap:24px;align-items:center;
    }
    .glass .title{flex:1}
    .glass h1{font-size:28px;letter-spacing:0.6px;margin-bottom:6px}
    .glass p{opacity:0.7;font-size:14px}
    .enter-btn{padding:14px 28px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:16px;
      background:linear-gradient(90deg,#ffd86b,#ff6060);color:#111;box-shadow:0 6px 18px rgba(255,96,96,0.18);transform:translateY(0);transition:transform .18s ease, box-shadow .18s ease;
    }
    .enter-btn:active{transform:translateY(2px);box-shadow:0 3px 8px rgba(0,0,0,0.2)}

    /* ---------- App layout ---------- */
    #app{position:relative;z-index:5;display:none}
    .topbar{height:72px;display:flex;align-items:center;padding:0 20px;gap:12px;border-bottom:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg, rgba(0,0,0,0.12), transparent)}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#ffd86b,#ff6060);display:flex;align-items:center;justify-content:center;font-weight:800;color:#111}
    .top-actions{margin-left:auto;display:flex;gap:8px}
    .btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer}

    /* ---------- Main split ---------- */
    .main{display:flex;height:calc(100% - 72px)}
    .sidebar{width:340px;border-right:1px solid rgba(255,255,255,0.02);padding:18px;overflow:auto}
    .content{flex:1;display:flex;align-items:center;justify-content:center;position:relative;padding:20px}

    /* ---------- Library cards ---------- */
    .lib-grid{display:grid;grid-template-columns:1fr;gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;display:flex;gap:12px;align-items:center}
    .thumb{width:64px;height:48px;border-radius:8px;background:#f5f5f5;overflow:hidden;box-shadow:inset 0 1px 0 rgba(255,255,255,0.06)}
    .meta{flex:1}
    .meta h4{font-size:14px}
    .meta p{font-size:12px;opacity:0.7}

    /* ---------- Diary / Book container ---------- */
    .book-wrap{width:min(980px,92%);height:min(640px,82%);position:relative;perspective:1800px}
    .book{position:absolute;inset:0;margin:auto;width:820px;height:560px;transform-style:preserve-3d;transition:all .8s cubic-bezier(.2,.8,.2,1);display:flex;align-items:center;justify-content:center}

    /* Cover */
    .cover{position:absolute;left:0;top:0;width:50%;height:100%;border-radius:12px;transform-origin:left center;backface-visibility:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.6)}
    .cover .front{position:absolute;inset:0;border-radius:12px;padding:28px;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;gap:12px;background:linear-gradient(180deg,#5b2a6e,#2b0e3a);color:white}
    .cover .spine{position:absolute;right:-28px;top:10%;width:28px;height:80%;background:linear-gradient(180deg,#3a123c,#1b0715);border-radius:4px}

    /* Pages stack */
    .pages{position:absolute;left:50%;top:0;width:50%;height:100%;transform-style:preserve-3d;pointer-events:auto}
    .page{position:absolute;left:0;top:0;width:100%;height:100%;background:#fff;border-radius:10px;box-shadow:0 12px 40px rgba(2,6,10,0.6);overflow:hidden}
    .page .paper{position:absolute;inset:16px;border-radius:6px;padding:24px;overflow:auto;background:linear-gradient(180deg,#fbf9f6,#f6f2ed);background-size:600px 600px}

    /* Page content editable area */
    .editor{width:100%;height:100%;outline:none;font-size:18px;line-height:1.6;color:#111;background:transparent}

    /* Page-turn animation helper */
    .turning{transition:transform .9s cubic-bezier(.2,.8,.2,1), box-shadow .9s;transform-origin:left center}

    /* Tiny controls overlaid */
    .page-controls{position:absolute;right:16px;bottom:16px;display:flex;gap:8px}

    /* Hidden index overlay */
    .index-overlay{position:fixed;inset:0;background:linear-gradient(180deg, rgba(2,6,10,0.6), rgba(2,6,10,0.85));display:none;align-items:center;justify-content:center;z-index:40}
    .index-panel{width:min(900px,96%);height:min(600px,86%);background:linear-gradient(180deg,#0a0b0f,#060608);border-radius:12px;padding:18px;overflow:auto}

    /* Responsive */
    @media(max-width:900px){.sidebar{display:none}.book-wrap{width:92%;height:72%}}

    /* small helpers */
    .muted{opacity:0.6;font-size:13px}
  </style>
</head>
<body>

<div class="bg-stars"><canvas id="stars"></canvas></div>

<!-- ENTER GLASS -->
<div class="enter-wrap" id="enterWrap">
  <div class="glass" role="dialog" aria-modal="true">
    <div class="title">
      <h1>Open Your RealDiary</h1>
      <p>Click ENTER to open a realistic diary ‚Äî write, save as PNG, and keep all pages in your index. Works offline (stored in your browser).</p>
      <p class="muted">Tip: Tap the page corners to turn. Use the "Save" button to add to Library.</p>
    </div>
    <div>
      <button class="enter-btn" id="enterBtn">ENTER</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="topbar">
    <div class="logo"><div class="mark">RD</div><div><strong>RealDiary</strong><div style="font-size:12px;opacity:0.6">Priyanshu ‚Ä¢ Ria</div></div></div>
    <div class="top-actions">
      <button class="btn" id="openIndexBtn">üìö Index</button>
      <button class="btn" id="newPageBtn">‚ûï New Page</button>
      <button class="btn" id="downloadAllBtn">‚¨áÔ∏è Export All</button>
    </div>
  </div>

  <div class="main">
    <aside class="sidebar">
      <h3>Saved Pages</h3>
      <div class="lib-grid" id="libraryList">
        <!-- Library items injected here -->
      </div>
    </aside>

    <section class="content">
      <div class="book-wrap" id="bookWrap">
        <div class="book" id="book">
          <!-- Cover -->
          <div class="cover" id="cover" style="z-index:30;">
            <div class="front" id="coverFront">
              <div style="font-size:20px;font-weight:700">My RealDiary</div>
              <div style="opacity:0.85">A place for memories & notes</div>
              <div style="margin-top:14px;font-size:12px;opacity:0.85">Tap cover to open ‚Üí</div>
            </div>
            <div class="spine"></div>
          </div>

          <!-- Pages area -->
          <div class="pages" id="pages" style="z-index:10;left:50%">
            <!-- JS will add pages here -->
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- INDEX OVERLAY -->
<div class="index-overlay" id="indexOverlay">
  <div class="index-panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <h2 style="margin:0">Library</h2>
      <div><button class="btn" id="closeIndex">Close</button></div>
    </div>
    <div id="indexGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px"></div>
  </div>
</div>

<!-- Hidden download anchor -->
<a id="downloadAnchor" style="display:none"></a>

<!-- External lib: html2canvas for screenshots -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5xH5qYfYjKqB2Z+gL2K6bGv9H8tCkKfTq3o2jUu6s3Zq3Z5Yk1pF5mXADYz0Q2YqBq0g1QZQ/2jz2jz2jz==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
// ---------- Utilities ----------
const $ = sel => document.querySelector(sel);
const qs = sel => document.querySelectorAll(sel);

// ---------- Starfield Background ----------
(function stars(){
  const canvas = document.getElementById('stars');
  const ctx = canvas.getContext('2d');
  function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
  addEventListener('resize', resize); resize();
  const stars=[]; for(let i=0;i<220;i++){stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.4,alpha:Math.random()*0.9})}
  function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);for(const s of stars){ctx.beginPath();ctx.globalAlpha=s.alpha;ctx.fillStyle='white';ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill()} }
  setInterval(()=>{for(const s of stars){s.alpha=0.5+Math.random()*0.8}s.x+=Math.random()*1-0.4;if(s.x>canvas.width)s.x=0;if(s.x<0)s.x=canvas.width} , 800);
  (function loop(){draw();requestAnimationFrame(loop)})();
})();

// ---------- App State ----------
const state = {
  pages: [], // {id, title, content, created}
  currentIndex: 0,
  coverOpen: false
};

// ---------- Local Storage Handling ----------
const LS_KEY = 'realdiary_pages_v1';
function loadFromStorage(){
  try{const raw=localStorage.getItem(LS_KEY);if(raw){state.pages=JSON.parse(raw);}else{state.pages=[];}}
  catch(e){console.warn('load err',e);state.pages=[]}
}
function saveToStorage(){localStorage.setItem(LS_KEY, JSON.stringify(state.pages));renderLibrary();renderIndexGrid()}

// ---------- Helpers ----------
function uid(prefix='p'){return prefix+Math.random().toString(36).slice(2,9)}

// ---------- Create a new blank page object ----------
function newBlankPage(){return {id:uid(),title:'Untitled',content:'',created:Date.now()}}

// ---------- Render Library (sidebar) ----------
function renderLibrary(){
  const container = $('#libraryList');container.innerHTML='';
  if(state.pages.length===0){container.innerHTML='<div class="muted">No saved pages yet. Save a page using Save ‚Üí Add to Library.</div>';return}
  state.pages.slice().reverse().forEach(p=>{
    const el = document.createElement('div');el.className='card';
    el.innerHTML = `<div class="thumb" data-id="${p.id}"><canvas width="160" height="120"></canvas></div><div class="meta"><h4>${escapeHtml(p.title)}</h4><p>${new Date(p.created).toLocaleString()}</p></div><div><button class="btn" data-load="${p.id}">Open</button></div>`;
    container.appendChild(el);
    // draw thumbnail
    const c = el.querySelector('canvas'); const ctx=c.getContext('2d'); ctx.fillStyle='#f6f2eb'; ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle='#222'; ctx.font='12px sans-serif'; ctx.fillText((p.title||'Untitled').slice(0,18),8,20);
  });
}

function renderIndexGrid(){
  const g = $('#indexGrid'); g.innerHTML='';
  state.pages.slice().reverse().forEach(p=>{
    const card = document.createElement('div');card.style.background='linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.1))';card.style.padding='12px';card.style.borderRadius='8px';
    card.innerHTML = `<div style="display:flex;gap:8px"><div style="flex:1"><strong>${escapeHtml(p.title)}</strong><div style="font-size:12px;opacity:0.7">${new Date(p.created).toLocaleString()}</div></div><div style="display:flex;flex-direction:column;gap:6px"><button class='btn' data-open='${p.id}'>Open</button><button class='btn' data-download='${p.id}'>Download PNG</button></div></div>`;
    g.appendChild(card);
  });
}

// ---------- Escape HTML helper ----------
function escapeHtml(str=''){return String(str).replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' })[c])}

// ---------- Book / Pages DOM Handling ----------
const pagesContainer = $('#pages');
function clearPages(){pagesContainer.innerHTML=''}

function createPageElement(pageObj,indexFromRight=0){
  // indexFromRight: 0 is topmost
  const wrapper = document.createElement('div'); wrapper.className='page'; wrapper.dataset.id=pageObj.id; wrapper.style.zIndex = 20 - indexFromRight;
  // paper texture via canvas background drawn later
  const paper = document.createElement('div'); paper.className='paper';
  const title = document.createElement('div'); title.style.fontWeight=700; title.style.marginBottom='6px'; title.textContent = pageObj.title;
  const editable = document.createElement('div'); editable.className='editor'; editable.contentEditable=true; editable.spellcheck=false; editable.innerHTML = pageObj.content || '';
  paper.appendChild(title); paper.appendChild(editable);

  const controls = document.createElement('div'); controls.className='page-controls';
  const saveBtn = document.createElement('button'); saveBtn.className='btn'; saveBtn.textContent='üíæ Save';
  const pngBtn = document.createElement('button'); pngBtn.className='btn'; pngBtn.textContent='üì∑ Save PNG';
  controls.appendChild(saveBtn); controls.appendChild(pngBtn);
  paper.appendChild(controls);

  wrapper.appendChild(paper);

  // page-turn by clicking right side
  wrapper.addEventListener('click', (e)=>{
    // only respond when clicking near right edge to turn
    const rect = wrapper.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if(x > rect.width*0.75){
      turnPage(wrapper);
    }
  });

  // Save handler
  saveBtn.addEventListener('click', (ev)=>{
    ev.stopPropagation();
    const id = wrapper.dataset.id; const content = editable.innerHTML; const p = state.pages.find(x=>x.id===id);
    if(p){p.content=content; p.title = (title.textContent||'Untitled'); saveToStorage(); alert('Saved to Library (updated).'); renderLibrary();}
    else{ // not in library yet
      const newP = {id:wrapper.dataset.id, title:title.textContent||'Untitled', content:content, created:Date.now()}; state.pages.push(newP); saveToStorage(); alert('Saved to Library.'); renderLibrary();}
  });

  // PNG handler
  pngBtn.addEventListener('click', (ev)=>{ev.stopPropagation(); takePagePNG(wrapper, pageObj.title||'page')});

  return wrapper;
}

function renderPagesFromState(){
  clearPages();
  // ensure at least one page open
  if(state.pages.length===0){ // create a temporary unsaved page
    const temp = newBlankPage(); temp.id='temp'; temp.title='Untitled'; temp.content='';
    const el = createPageElement(temp,0); pagesContainer.appendChild(el); state.currentIndex=0; return;
  }
  // We'll render top 6 pages (simulate infinite by lazy)
  const arr = state.pages.slice(-6); // last ones
  arr.forEach((p,i)=>{ const el = createPageElement(p,i); pagesContainer.appendChild(el); });
}

// ---------- Page Turn Animation ----------
function turnPage(pageEl){
  pageEl.classList.add('turning');
  pageEl.style.transform = 'rotateY(-160deg) translateX(-40px)';
  pageEl.style.boxShadow = '0 40px 120px rgba(2,6,10,0.8)';
  setTimeout(()=>{ // after animation, remove it (simulate book flipping)
    pageEl.remove();
  },900);
}

// ---------- Cover open animation ----------
const cover = $('#cover');
cover.addEventListener('click', ()=>{
  if(state.coverOpen) return; state.coverOpen=true; openCover();
});
function openCover(){
  // animate cover to left rotation
  cover.style.transition='transform 900ms cubic-bezier(.2,.8,.2,1), left 900ms';
  cover.style.transform='rotateY(-160deg) translateX(-28px)';
  // bring pages into visibility
  setTimeout(()=>{
    $('#app').style.display='block';
    document.getElementById('enterWrap').style.display='none';
    // populate pages container
    renderPagesFromState();
  },380);
}

// ---------- Enter button ----------
$('#enterBtn').addEventListener('click', ()=>{
  // animate enter out, show app & book
  document.getElementById('enterWrap').style.transition='opacity 300ms'; document.getElementById('enterWrap').style.opacity=0;
  setTimeout(()=>{document.getElementById('enterWrap').style.display='none'; $('#app').style.display='block';},320);
  // tiny delay then animate cover pop
  setTimeout(()=>{cover.style.transform='translateZ(12px)';},120);
});

// ---------- New Page ----------
$('#newPageBtn').addEventListener('click', ()=>{
  const p = newBlankPage(); p.title='Page '+(state.pages.length+1); state.pages.push(p); saveToStorage(); renderLibrary(); renderPagesFromState();
});

// ---------- Download all as JSON bundle (Export All) ----------
$('#downloadAllBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(state.pages, null, 2); const blob = new Blob([data], {type:'application/json'}); const url=URL.createObjectURL(blob);
  const a = document.getElementById('downloadAnchor'); a.href=url; a.download='realdiary-backup.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),2000);
});

// ---------- Index Overlay ----------
$('#openIndexBtn').addEventListener('click', ()=>{ $('#indexOverlay').style.display='flex'; renderIndexGrid(); });
$('#closeIndex').addEventListener('click', ()=>{ $('#indexOverlay').style.display='none'; });

// index grid actions (open, download)
$('#indexOverlay').addEventListener('click', (e)=>{
  const openId = e.target.closest('[data-open]')?.dataset.open;
  const downloadId = e.target.closest('[data-download]')?.dataset.download;
  if(openId){openSavedPage(openId); $('#indexOverlay').style.display='none';}
  if(downloadId){const p = state.pages.find(x=>x.id===downloadId); if(p) downloadPagePNGFromData(p);}
});

// ---------- Library sidebar open buttons ----------
$('#libraryList').addEventListener('click', (e)=>{
  const id = e.target.closest('[data-load]')?.dataset.load; if(id){openSavedPage(id)}
});

function openSavedPage(id){
  const p = state.pages.find(x=>x.id===id); if(!p) return alert('Page not found');
  // render that single page on top
  clearPages(); const el = createPageElement(p,0); pagesContainer.appendChild(el);
}

// ---------- PNG from Page element ----------
function takePagePNG(pageEl, title='page'){
  // use html2canvas to render the pageEl
  html2canvas(pageEl, {scale:2, useCORS:true, backgroundColor:null}).then(canvas=>{
    canvas.toBlob(blob=>{ const url = URL.createObjectURL(blob); const a = document.getElementById('downloadAnchor'); a.href=url; a.download = (title.replace(/[^a-z0-9]/gi,'_')||'page') + '.png'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),2000); });
  }).catch(err=>{console.error(err); alert('Could not export PNG: '+err.message)});
}

function downloadPagePNGFromData(pageData){
  // render a temporary offscreen page for crisp png
  const tmp = document.createElement('div'); tmp.style.width='800px'; tmp.style.height='560px'; tmp.style.padding='16px'; tmp.style.background='#fff'; tmp.style.borderRadius='10px'; tmp.innerHTML=`<div style="padding:24px;font-family:sans-serif;color:#111"><h2>${escapeHtml(pageData.title)}</h2><div style="font-size:15px">${pageData.content}</div></div>`;
  document.body.appendChild(tmp);
  html2canvas(tmp, {scale:2}).then(canvas=>{ canvas.toBlob(blob=>{ const url = URL.createObjectURL(blob); const a = document.getElementById('downloadAnchor'); a.href=url; a.download=(pageData.title.replace(/[^a-z0-9]/gi,'_')||'page')+'.png'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),2000); tmp.remove(); }); }).catch(e=>{tmp.remove(); alert('Error: '+e.message)});
}

// ---------- Init ----------
function init(){loadFromStorage(); renderLibrary(); renderIndexGrid();
  // show enter overlay by default
  document.getElementById('enterWrap').style.display='flex';
  // draw initial cover position
  cover.style.left='calc(50% - 410px)'; cover.style.width='50%'; cover.style.height='100%';
  // position book
  const bookEl = document.getElementById('book'); bookEl.style.left='50%';
}

init();

// ---------- small UX: save on unload ----------
addEventListener('beforeunload', ()=>{ saveToStorage(); });

</script>
</body>
</html>
